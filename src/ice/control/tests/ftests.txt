===========
ice.control
===========

:doctest:
:functional-zcml-layer: ftesting.zcml

Boilerplates::

  >>> import transaction
  >>> import zope.component
  >>> from zope.testbrowser.testing import Browser
  >>> from zope.publisher.browser import TestRequest
  >>> from zope.interface.verify import verifyObject

  >>> root_url = 'http://localhost'
  >>> control_url = root_url + '/++etc++control'
  >>> browser = Browser()


Skin resources
--------------

  >>> browser.open(root_url)
  >>> browser.headers['status']
  '200 Ok'

  >>> 'http://localhost/++resource++default.css' in browser.contents
  True

  >>> browser.open('http://localhost/++resource++default.css')
  >>> browser.headers['status']
  '200 Ok'

  >>> browser.open('http://localhost/++resource++img/bluebream_logo.png')
  >>> browser.headers['status']
  '200 Ok'


System control panel
--------------------

  >>> browser.open(root_url)
  >>> browser.getLink(text='System control').click()
  Traceback (most recent call last):
  ...
  httperror_seek_wrapper: HTTP Error 401: Unauthorized

  >>> browser.addHeader('Authorization','Basic mgr:mgrpw')
  >>> browser.handleErrors = False

  >>> browser.open(root_url)
  >>> browser.getLink(text='System control').click()

  >>> browser.url == control_url + '/tree.html'
  True


Contents tree
-------------

Resources loaded::

  >>> 'script src="http://localhost/@@/ice.control.tree.js/tree.js"' in browser.contents
  True

  >>> 'script src="http://localhost/@@/ice.control.tree.js/jquery-1.4.2.min.js"' in browser.contents
  True

  >>> '@import url("http://localhost/@@/ice.control.tree.css/tree.css");' in browser.contents
  True

Selected menu item::

  >>> '<td class="selected">\n      <a href="tree.html">Tree</a>\n    </td>' in browser.contents
  True

Create sample content::

  >>> root = getRootFolder()
  >>> root
  <zope.site.folder.Folder object at ...>

  >>> list(root)
  []

  >>> from zope.site.folder import Folder

  >>> root['first'] = Folder()
  >>> root['second'] = Folder()
  >>> root['third'] = Folder()
  >>> root['fourth'] = Folder()
  >>> root['fifth'] = Folder()

Verify xml presentation protocol staff::

  >>> from ice.control.controls.tree.interfaces import IXML
  >>> request = TestRequest()

  >>> x = zope.component.getMultiAdapter((root, request), IXML)

  >>> verifyObject(IXML, x)
  True

  >>> x.name()
  u''

  >>> x.path()
  'http://127.0.0.1'

  >>> x.title()
  u''

  >>> x.icon_url()
  'http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png'

  >>> x.size()
  5

  >>> x.is_container()
  True

  >>> x.length()
  5

  >>> x.sort_key() is None
  True

  >>> print x.to_xml()
  <node name="" path="http://127.0.0.1" title=""
        icon_url="http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png"
        size="5" length="5" is_container="true" />

  >>> print x.node_xmldoc()
  <?xml version="1.0" ?>
  <document>
  <node name="" path="http://127.0.0.1" title=""
	icon_url="http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png"
        size="5" length="5" is_container="true" />
  </document>

  >>> print x.children_xmldoc()
  <?xml version="1.0" ?>
  <document>
  <node name="fifth" path="http://127.0.0.1/fifth" title=""
        icon_url="http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png"            size="0" length="0" is_container="true" />
  <BLANKLINE>
  <node name="first" path="http://127.0.0.1/first" title=""
        icon_url="http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png"
        size="0" length="0" is_container="true" />
  <BLANKLINE>
  <node name="fourth" path="http://127.0.0.1/fourth" title=""
        icon_url="http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png"
        size="0" length="0" is_container="true" />
  <BLANKLINE>
  <node name="second" path="http://127.0.0.1/second" title=""
        icon_url="http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png"
        size="0" length="0" is_container="true" />
  <BLANKLINE>
  <node name="third" path="http://127.0.0.1/third" title=""
        icon_url="http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png"
        size="0" length="0" is_container="true" />
  <BLANKLINE>
  <node name="++etc++site" path="http://127.0.0.1/++etc++site" title="" icon_url=""
        size="1" length="1" is_container="true" />
  </document>


Generations
-----------

  >>> browser.open(control_url + '/tree.html')

  >>> browser.getLink('Generations').click()
  >>> browser.url == control_url + '/generations.html'
  True

  >>> 'Generations' in browser.contents
  True

  >>> 'Application' in browser.contents
  True

  >>> 'Minimum Generation' in browser.contents
  True

  >>> 'Maximum Generation' in browser.contents
  True

  >>> 'Current Database Generation' in browser.contents
  True

  >>> 'Evolve?' in browser.contents
  True

  >>> 'ice.control' in browser.contents
  True

  >>> browser.getLink(text='ice.control').click()
  >>> browser.url == control_url + '/generations_managerdetails.html?id=ice.control'
  True

  >>> 'This is test generation' in browser.contents
  True

===========
ice.control
===========

:doctest:
:functional-zcml-layer: ftesting.zcml

Boilerplates::

  >>> import transaction
  >>> import zope.component
  >>> from zope.testbrowser.testing import Browser
  >>> from zope.publisher.browser import TestRequest
  >>> from zope.interface.verify import verifyObject

  >>> root_url = 'http://localhost'
  >>> control_url = root_url + '/++etc++control'
  >>> browser = Browser()


Skin resources
--------------

  >>> browser.open(root_url)
  >>> browser.headers['status']
  '200 Ok'

  >>> 'http://localhost/++resource++default.css' in browser.contents
  True

  >>> browser.open('http://localhost/++resource++default.css')
  >>> browser.headers['status']
  '200 Ok'

  >>> browser.open('http://localhost/++resource++img/bluebream_logo.png')
  >>> browser.headers['status']
  '200 Ok'


System control panel
--------------------

  >>> browser.open(root_url)
  >>> browser.getLink(text='System control').click()
  Traceback (most recent call last):
  ...
  httperror_seek_wrapper: HTTP Error 401: Unauthorized

  >>> browser.addHeader('Authorization','Basic mgr:mgrpw')
  >>> browser.handleErrors = False

  >>> browser.open(root_url)
  >>> browser.getLink(text='System control').click()

  >>> browser.url == control_url + '/tree.html'
  True


Contents tree
-------------

Resources loaded::

  >>> 'script src="http://localhost/@@/ice.control.tree.js/tree.js"' in browser.contents
  True

  >>> 'script src="http://localhost/@@/ice.control.tree.js/jquery-1.4.2.min.js"' in browser.contents
  True

  >>> '@import url("http://localhost/@@/ice.control.tree.css/tree.css");' in browser.contents
  True

Selected menu item::

  >>> '<td class="selected">\n      <a href="tree.html">Tree</a>\n    </td>' in browser.contents
  True

Create sample content::

  >>> root = getRootFolder()
  >>> root
  <zope.site.folder.Folder object at ...>

  >>> list(root)
  []

  >>> from zope.site.folder import Folder

  >>> root['first'] = Folder()
  >>> root['second'] = Folder()
  >>> root['third'] = Folder()
  >>> root['fourth'] = Folder()
  >>> root['fifth'] = Folder()

Verify xml presentation protocol staff::

  >>> from ice.control.controls.tree.interfaces import IXML
  >>> request = TestRequest()

  >>> x = zope.component.getMultiAdapter((root, request), IXML)

  >>> verifyObject(IXML, x)
  True

  >>> x.name()
  u'<name></name>'

  >>> x.url()
  u'<url>http://127.0.0.1</url>'

  >>> x.title()
  u''

  >>> x.icon_url()
  u'<icon_url>http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png</icon_url>'
  >>> x.size()
  u'<size>5</size>'

  >>> x.is_container()
  u'<is_container>True</is_container>'

  >>> x.length()
  u'<length>5</length>'

  >>> x.sort_key() is None
  True

  >>> print x.children()
  <children><child><name>fifth</name><url>http://127.0.0.1/fifth</url><icon_url>http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png</icon_url><size>0</size><is_container>True</is_container><length>0</length></child>
  <child><name>first</name><url>http://127.0.0.1/first</url><icon_url>http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png</icon_url><size>0</size><is_container>True</is_container><length>0</length></child>
  <child><name>fourth</name><url>http://127.0.0.1/fourth</url><icon_url>http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png</icon_url><size>0</size><is_container>True</is_container><length>0</length></child>
  <child><name>second</name><url>http://127.0.0.1/second</url><icon_url>http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png</icon_url><size>0</size><is_container>True</is_container><length>0</length></child>
  <child><name>third</name><url>http://127.0.0.1/third</url><icon_url>http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png</icon_url><size>0</size><is_container>True</is_container><length>0</length></child>
  <child><name>++etc++site</name><url>http://127.0.0.1/++etc++site</url><size>1</size><is_container>True</is_container><length>1</length></child></children>

  >>> print x.xml_lexemes()
  <name></name><url>http://127.0.0.1</url><icon_url>http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png</icon_url><size>5</size><is_container>True</is_container><length>5</length>

  >>> print x.xml_document()
  <?xml version="1.0" ?><document><name></name><url>http://127.0.0.1</url><icon_url>http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png</icon_url><size>5</size><is_container>True</is_container><length>5</length>
  <children><child><name>fifth</name><url>http://127.0.0.1/fifth</url><icon_url>http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png</icon_url><size>0</size><is_container>True</is_container><length>0</length></child>
  <child><name>first</name><url>http://127.0.0.1/first</url><icon_url>http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png</icon_url><size>0</size><is_container>True</is_container><length>0</length></child>
  <child><name>fourth</name><url>http://127.0.0.1/fourth</url><icon_url>http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png</icon_url><size>0</size><is_container>True</is_container><length>0</length></child>
  <child><name>second</name><url>http://127.0.0.1/second</url><icon_url>http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png</icon_url><size>0</size><is_container>True</is_container><length>0</length></child>
  <child><name>third</name><url>http://127.0.0.1/third</url><icon_url>http://127.0.0.1/@@/zope-site-interfaces-IFolder-control_icon.png</icon_url><size>0</size><is_container>True</is_container><length>0</length></child>
  <child><name>++etc++site</name><url>http://127.0.0.1/++etc++site</url><size>1</size><is_container>True</is_container><length>1</length></child></children></document>


Generations
-----------

  >>> browser.open(control_url + '/tree.html')

  >>> browser.getLink('Generations').click()
  >>> browser.url == control_url + '/generations.html'
  True

  >>> 'Generations' in browser.contents
  True

  >>> 'Application' in browser.contents
  True

  >>> 'Minimum Generation' in browser.contents
  True

  >>> 'Maximum Generation' in browser.contents
  True

  >>> 'Current Database Generation' in browser.contents
  True

  >>> 'Evolve?' in browser.contents
  True

  >>> 'ice.control' in browser.contents
  True

  >>> browser.getLink(text='ice.control').click()
  >>> browser.url == control_url + '/generations_managerdetails.html?id=ice.control'
  True

  >>> 'This is test generation' in browser.contents
  True
